<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RSVP - Varuni &amp; Varun</title>

  <!-- Preconnect to Google Fonts to eliminate render-blocking DNS round-trips -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400;1,600&family=Cinzel:wght@300;400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #17385e;
      --navy:      #16385f;
      --navy-mid:  #3c628f;
      --gold:      #c9a96e;
      --gold-lt:   #e0c898;
      --gold-dk:   #a07830;
      --cream:     #fdf6ec;
      --ivory:     #fefaf4;
      --text:      #0b1f3b;
      --text-mid:  #16365d;
      --muted:     rgba(11,31,59,0.92);
      --border:    rgba(11,31,59,0.28);
      --gborder:   rgba(201,169,110,0.35);
    }

    /* â”€â”€ Dark page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    html, body {
      min-height: 100vh;
      background-color: #10233f;
      font-family: 'Cormorant Garamond', Georgia, serif;
      color: var(--text);
      overflow-x: hidden;
    }

    /* Noise grain */
    body::before {
      content: '';
      position: fixed; inset: 0; z-index: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.88' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.06'/%3E%3C/svg%3E");
      pointer-events: none;
    }

    /* Radial depth / tiled background */
    body::after {
      content: '';
      position: fixed; inset: 0; z-index: 0;
      background-image: url("assets/first-page-bg.png");
      background-size: 560px auto;
      background-position: center top;
      background-repeat: repeat;
      opacity: 0.95;
      pointer-events: none;
    }

    /* Per-view full-bleed backgrounds */
    body.intro-view::after {
      background-image: url("assets/first-page-bg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 1;
    }

    body.no-view::after {
      background-image: url("assets/second-page-bg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 1;
    }

    body.yes-view::after {
      background-image: url("assets/third-page-bg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 1;
    }

    /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .page {
      position: relative; z-index: 2;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4rem 1.5rem 3.5rem;
    }

    /* â”€â”€ Cream card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card {
      width: 100%;
      max-width: 920px;
      background-color: #eff3fa;
      background-image: url("assets/first-page-form.png");
      background-size: cover;
      background-position: center top;
      background-repeat: no-repeat;
      position: relative;
      overflow: hidden;
      z-index: 3;
      box-shadow:
        0 0 0 1px rgba(201,169,110,0.45),
        0 40px 100px rgba(0,0,0,0.65),
        0 10px 30px  rgba(0,0,0,0.35);
      animation: riseIn 0.9s cubic-bezier(0.22,1,0.36,1) both;
      padding: 1.5rem;
    }

    /* Page-specific full-card backgrounds */
    body.intro-view .card {
      background-image: url("assets/mobile-first-page-form.png");
      background-size: 100% 100%;
      background-position: center center;
      background-repeat: no-repeat;
      background-color: #eff3fa;
    }

    body.no-view .card {
      background-image: url("assets/mobile-second-page-form.png");
      background-size: 100% 100%;
      background-position: center center;
      background-repeat: no-repeat;
      background-color: #eff3fa;
    }

    body.yes-view .card {
      background-image: url("assets/mobile-third-page-form.png");
      background-size: 100% 100%;
      background-position: center center;
      background-repeat: no-repeat;
    }

    body.intro-view .card-inner { padding-top: 5.6rem; }

    body.intro-view .header .reply-label { display: none; }
    body.yes-view   .header .reply-label { display: none; }
    body.no-view    .header              { display: none; }
    body.intro-view .header              { margin-bottom: 1.1rem; }
    body.no-view    .card-inner          { padding-top: 2.6rem; }

    @keyframes riseIn {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* Inset gold border */
    .card::after {
      content: '';
      position: absolute; inset: 8px;
      border: 1px solid var(--gborder);
      pointer-events: none; z-index: 0;
    }

    .card-inner {
      width: calc(100% - 3.2rem);
      margin: 0 auto;
      padding: 3.8rem 4rem 3.6rem;
      background: transparent;
      border: none;
      position: relative; z-index: 1;
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header { text-align: center; margin-bottom: 1.75rem; }

    .reply-label {
      font-family: 'Cinzel', serif;
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.35em;
      color: var(--gold-dk);
      text-transform: uppercase;
      margin-bottom: 0.75rem;
    }

    .couple-names {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: clamp(3.4rem, 9vw, 4.6rem);
      font-weight: 300;
      font-style: italic;
      line-height: 1.05;
      color: var(--navy);
    }

    .couple-names .amp {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      color: var(--gold);
      font-size: 1.05em;
    }

    .divider {
      display: flex; align-items: center; gap: 0.75rem;
      margin: 1rem 0;
    }
    .divider::before, .divider::after {
      content: ''; flex: 1; height: 1px;
      background: linear-gradient(to right, transparent, rgba(201,169,110,0.55), transparent);
    }
    .div-gem { width: 5px; height: 5px; background: var(--gold); transform: rotate(45deg); flex-shrink: 0; }

    .celebration-title {
      font-family: 'Cinzel', serif;
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.18em;
      color: var(--text-mid);
      margin-bottom: 0.3rem;
    }

    .celebration-dates {
      font-size: 1.2rem;
      color: var(--text-mid);
      font-weight: 600;
      letter-spacing: 0.05em;
      font-style: italic;
    }

    /* â”€â”€ Section label â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .field-label {
      display: block;
      font-family: 'Cinzel', serif;
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-mid);
      margin-bottom: 0.7rem;
      opacity: 1;
    }

    .form-section { margin-bottom: 1.75rem; }
    .form-section--sm { margin-bottom: 1rem; }

    /* â”€â”€ Utility â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hidden { display: none !important; }

    /* â”€â”€ Back link â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .back-link {
      background: none;
      border: none;
      cursor: pointer;
      font-family: 'Cinzel', serif;
      font-size: 0.75rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--gold-dk);
      opacity: 0.85;
      padding: 0;
      margin-bottom: 1.2rem;
      display: inline-block;
      transition: opacity 0.2s;
    }
    .back-link:hover { opacity: 1; }

    /* â”€â”€ Inline error messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .error-msg {
      display: none;
      margin-top: 0.55rem;
      font-family: 'Cinzel', serif;
      font-size: 0.73rem;
      letter-spacing: 0.1em;
      color: #8c1a2a;
      font-weight: 600;
    }

    /* â”€â”€ Multi-page flow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .flow-page { display: none; }
    .flow-page.active { display: block; animation: riseIn 0.35s ease both; }

    .invite-box {
      max-width: 460px;
      margin: 0 auto;
      margin-top: 0.6rem;
      min-height: auto;
      border: 1px solid var(--border);
      background: transparent;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 1rem 1.25rem 0.75rem;
      text-align: center;
    }

    .invite-title {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: clamp(1.3rem, 5.5vw, 1.85rem);
      font-style: italic;
      font-weight: 400;
      color: var(--navy);
      line-height: 1.25;
      margin-bottom: 0.4rem;
      white-space: nowrap;
    }

    .invite-sub {
      font-size: 1.05rem;
      color: var(--text-mid);
      font-weight: 400;
      margin-bottom: 0.85rem;
      font-style: italic;
    }

    .invite-actions {
      width: 100%;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.6rem;
      margin-top: 0.2rem;
      margin-bottom: 0.3rem;
    }

    .plain-choice {
      border: 1px solid rgba(20,38,66,0.35);
      background: rgba(255,255,255,0.28);
      color: var(--text);
      font-family: 'Cinzel', serif;
      font-size: 0.78rem;
      font-weight: 700;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      padding: 0.65rem 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .plain-choice:hover {
      background: rgba(22,56,95,0.92);
      border-color: rgba(22,56,95,0.92);
      color: var(--gold-lt);
    }

    #choose-no {
      transition: transform 0.22s ease, background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
      transform-origin: center;
    }

    .invite-bottom-reply {
      margin-top: 0.25rem;
      margin-bottom: 0.25rem;
      font-family: 'Cinzel', serif;
      font-size: 0.78rem;
      font-weight: 700;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--gold-dk);
      line-height: 1.7;
      text-align: center;
    }

    .emoji-fx {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) scale(0.5);
      font-size: clamp(2.2rem, 8vw, 4rem);
      z-index: 1200;
      pointer-events: none;
      opacity: 0;
      animation: emojiPop 780ms ease forwards;
      text-shadow: 0 6px 25px rgba(0,0,0,0.25);
    }

    @keyframes emojiPop {
      0%   { opacity: 0; transform: translate(-50%, -46%) scale(0.4); }
      25%  { opacity: 1; transform: translate(-50%, -53%) scale(1.1); }
      60%  { opacity: 1; transform: translate(-50%, -62%) scale(0.96); }
      100% { opacity: 0; transform: translate(-50%, -78%) scale(0.85); }
    }

    .emoji-rain-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1150;
      overflow: hidden;
    }

    .emoji-drop {
      position: absolute;
      top: -40px;
      animation-name: emojiFall;
      animation-timing-function: linear;
      animation-fill-mode: forwards;
      will-change: transform, opacity;
    }

    @keyframes emojiFall {
      0%   { opacity: 0.96; transform: translateY(-40px) rotate(0deg); }
      85%  { opacity: 0.95; }
      100% { opacity: 0; transform: translateY(calc(100vh + 80px)) rotate(260deg); }
    }

    .decline-card {
      max-width: 620px;
      margin: 0 auto;
      text-align: center;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.16);
      padding: 2.2rem 2rem 1.95rem;
    }

    .page-no-title {
      text-align: center;
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 2.9rem;
      font-style: italic;
      font-weight: 300;
      color: var(--navy);
      margin-bottom: 1.1rem;
    }

    .decline-title {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 2.6rem;
      font-style: italic;
      font-weight: 300;
      color: var(--navy);
      margin-bottom: 0.55rem;
    }

    .decline-copy {
      font-size: 1.24rem;
      color: var(--text-mid);
      font-style: normal;
      font-weight: 600;
      margin-bottom: 1.1rem;
    }

    .ghost-btn {
      border: 1px solid rgba(20,38,66,0.3);
      background: transparent;
      color: var(--text-mid);
      font-family: 'Cinzel', serif;
      font-size: 0.78rem;
      letter-spacing: 0.16em;
      font-weight: 700;
      text-transform: uppercase;
      padding: 0.75rem 1rem;
      cursor: pointer;
      margin-top: 0.6rem;
      transition: opacity 0.2s;
    }

    .ghost-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .decline-form { text-align: center; margin-top: 0.85rem; }
    .decline-form.hide { display: none; }
    .decline-form .field-label { font-size: 0.78rem; margin-bottom: 0.5rem; }
    .decline-form input[type="text"],
    .decline-form textarea { text-align: center; }

    .decline-submit-wrap { margin-top: 1rem; text-align: center; }

    .decline-success { display: none; text-align: center; padding: 3rem 0 1.5rem; }
    .decline-success.show { display: block; animation: riseIn 0.6s ease both; }
    .decline-success h2 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 2.9rem;
      font-style: italic;
      font-weight: 300;
      color: var(--navy);
      margin-bottom: 0.5rem;
    }
    .decline-success .footer-line { margin-top: 0.5rem; }

    /* â”€â”€ Name â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .input-wrap { position: relative; }

    input[type="text"] {
      width: 100%;
      background: transparent;
      border: none;
      border-bottom: 1px solid var(--border);
      color: var(--text);
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.34rem;
      font-style: italic;
      padding: 0.6rem 2rem 0.6rem 0;
      outline: none;
      transition: border-color 0.25s;
    }

    input[type="text"]:focus { border-bottom-color: var(--gold); }
    input[type="text"]::placeholder { color: rgba(11,31,59,0.68); }

    .input-suffix {
      position: absolute; right: 0; top: 50%;
      transform: translateY(-50%);
      color: var(--muted); pointer-events: none;
    }

    /* â”€â”€ Event cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .events-list { display: flex; flex-direction: column; gap: 0.6rem; }

    .event-check { position: relative; }
    .event-check input[type="checkbox"] { position: absolute; opacity: 0; width: 0; height: 0; }

    .event-check label {
      display: flex;
      align-items: center;
      gap: 0.85rem;
      padding: 0.72rem 0.9rem;
      border: 1px solid var(--border);
      cursor: pointer;
      transition: border-color 0.25s, background 0.25s;
    }

    .event-check label:hover { border-color: var(--gborder); }

    .event-check input:checked + label {
      border-color: var(--gold);
      background: rgba(201,169,110,0.07);
    }

    .ev-icon {
      width: 34px; height: 34px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      color: var(--gold); opacity: 0.55;
      transition: opacity 0.25s;
    }

    .ev-icon img {
      width: 30px; height: 30px;
      object-fit: contain;
      display: block;
    }

    .event-check input:checked + label .ev-icon { opacity: 1; }

    .ev-info { flex: 1; display: flex; flex-direction: column; gap: 0.12rem; }

    .ev-name {
      font-family: 'Cinzel', serif;
      font-size: 0.82rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--navy);
      font-weight: 700;
    }

    .ev-date { font-size: 1.12rem; color: var(--text-mid); font-style: italic; font-weight: 600; }

    .ev-indicator {
      width: 16px; height: 16px;
      border-radius: 50%;
      border: 1.5px solid rgba(13,27,42,0.2);
      flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      transition: border-color 0.2s;
    }

    .ev-indicator::after {
      content: '';
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--gold);
      transform: scale(0);
      transition: transform 0.2s;
    }

    .event-check input:checked + label .ev-indicator { border-color: var(--gold); }
    .event-check input:checked + label .ev-indicator::after { transform: scale(1); }

    /* â”€â”€ Accommodation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .radio-row { display: flex; gap: 0.7rem; }

    .radio-pill { position: relative; flex: 1; }
    .radio-pill input[type="radio"] { position: absolute; opacity: 0; width: 0; height: 0; }

    .radio-pill label {
      display: flex; align-items: center; justify-content: center;
      padding: 0.75rem 0.9rem;
      border: 1px solid var(--border);
      border-radius: 999px;
      cursor: pointer;
      font-family: 'Cinzel', serif;
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--muted);
      transition: all 0.25s;
    }

    .radio-pill input:checked + label {
      background: var(--navy);
      border-color: var(--navy);
      color: var(--gold);
    }

    .radio-pill label:hover { border-color: var(--navy-mid); color: var(--text); }

    /* â”€â”€ Arrival / departure pair â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .date-pair {
      display: grid;
      grid-template-columns: 1fr 1px 1fr;
      border: 1px solid var(--border);
    }

    .date-cell { padding: 0.8rem 1rem; display: flex; flex-direction: column; gap: 0.25rem; }

    .date-cell-divider { background: var(--border); }

    .date-tiny {
      font-family: 'Cinzel', serif;
      font-size: 0.76rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--muted);
    }

    input[type="date"] {
      background: transparent;
      border: none;
      color: var(--text);
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.24rem;
      font-style: italic;
      outline: none;
      color-scheme: light;
      cursor: pointer;
      width: 100%;
      padding: 0;
    }

    /* â”€â”€ Guest stepper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stepper {
      display: inline-flex;
      align-items: center;
      gap: 0;
      border: 1px solid var(--border);
    }

    #guest-section { text-align: center; }

    .step-btn {
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      background: transparent;
      border: none;
      border-right: 1px solid var(--border);
      color: var(--navy);
      cursor: pointer;
      font-size: 1.1rem;
      line-height: 1;
      transition: all 0.2s;
      font-family: 'Cormorant Garamond', serif;
    }

    .step-btn:last-child { border-right: none; border-left: 1px solid var(--border); }
    .step-btn:hover { background: var(--navy); color: var(--gold); }

    .guest-display {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.3rem;
      color: var(--text);
      padding: 0 1.25rem;
      min-width: 100px;
      text-align: center;
      font-style: italic;
    }

    /* â”€â”€ Message textarea â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    textarea {
      width: 100%;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.24rem;
      font-style: italic;
      padding: 0.75rem 1rem;
      outline: none;
      resize: none;
      height: 82px;
      transition: border-color 0.25s;
    }

    /* Subtle readability panel on the long RSVP form page */
    body.yes-view #formContent {
      background: rgba(255,255,255,0.16);
      border: 1px solid rgba(11,31,59,0.2);
      padding: 1rem 1rem 0.4rem;
      max-width: 760px;
      margin: 0 auto;
    }

    textarea:focus { border-color: var(--gold); }
    textarea::placeholder { color: var(--muted); }

    /* â”€â”€ Submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .submit-wrap {
      margin-top: 1.9rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(13,27,42,0.1);
      text-align: center;
    }

    .btn-submit {
      width: auto;
      min-width: 260px;
      font-family: 'Cinzel', serif;
      font-size: 0.76rem;
      letter-spacing: 0.28em;
      text-transform: uppercase;
      padding: 0.88rem 1.3rem;
      background: var(--navy);
      border: none;
      color: var(--gold);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      transition: color 0.35s;
    }

    .btn-submit::before {
      content: '';
      position: absolute; inset: 0;
      background: linear-gradient(90deg, var(--gold-dk), var(--gold));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.4s ease;
    }

    .btn-submit:hover::before { transform: scaleX(1); }
    .btn-submit:hover { color: var(--navy); }
    .btn-submit > * { position: relative; z-index: 1; }
    .btn-submit:disabled { opacity: 0.5; cursor: not-allowed; }

    /* Loading spinner â€” spins a small ring inside the button */
    .btn-submit .btn-spinner {
      display: none;
      width: 14px; height: 14px;
      border: 2px solid rgba(201,169,110,0.35);
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      flex-shrink: 0;
    }

    .btn-submit.loading .btn-spinner { display: block; }
    .btn-submit.loading .btn-arrow   { display: none; }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .footer-line {
      text-align: center;
      font-size: 1.25rem;
      color: var(--muted);
      font-style: italic;
      margin-top: 1rem;
      font-weight: 600;
    }

    /* â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .success { display: none; text-align: center; padding: 3rem 0 1.5rem; }
    .success.show { display: block; animation: riseIn 0.6s ease both; }
    .form-content.hide { display: none; }

    .success h2 {
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 2.9rem;
      font-style: italic;
      font-weight: 300;
      color: var(--navy);
      margin-bottom: 0.5rem;
    }

    .success .footer-line { margin-top: 0.5rem; }

    #confetti-canvas { position: fixed; inset: 0; pointer-events: none; z-index: 999; }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

    /* â€” Tablet (â‰¤ 1080px) â€” */
    @media (max-width: 1080px) {
      .card { max-width: 860px; }
      .card-inner {
        width: calc(100% - 2.2rem);
        padding: 3rem 2.7rem 3.1rem;
      }
    }

    /* â€” Tablet / mobile (â‰¤ 768px) â€” */
    @media (max-width: 768px) {
      /* Remove side padding from the page so the card can have its own
         margin, making the background visible on both sides */
      .page { padding: 1.5rem 0 2rem; }

      /* Narrower card floats on the background with visible gaps */
      .card {
        width: calc(100% - 2.5rem);
        margin: 0 auto;
        padding: 1.1rem;
      }

      .card-inner {
        width: calc(100% - 1.6rem);
        padding: 1.8rem 1.1rem 2rem;
      }

      /* Override the desktop-only top-padding rules that bleed into mobile */
      body.intro-view .card-inner { padding-top: 3.5rem; }
      body.no-view    .card-inner { padding-top: 1.4rem; }

      .invite-box { min-height: auto; padding: 1rem 1rem 0.9rem; }

      /* Tighter form spacing on mobile */
      .form-section     { margin-bottom: 1.1rem; }
      .form-section--sm { margin-bottom: 0.7rem; }

      .submit-wrap { margin-top: 1.1rem; padding-top: 0.9rem; }

      /* Slightly compact event-check rows */
      .event-check label { padding: 0.58rem 0.75rem; }

      /* Centre-align form labels and inputs on mobile */
      .field-label { text-align: center; }
      .date-tiny   { text-align: center; }
      input[type="text"]  { text-align: center; padding-right: 0; }
      input[type="date"]  { text-align: center; }
      textarea            { text-align: center; }
      /* Hide the decorative suffix icon when input text is centred */
      .input-suffix { display: none; }

      /* Stack date pair into two rows */
      .date-pair { grid-template-columns: 1fr; }
      .date-cell-divider { height: 1px; width: auto; }
    }

    /* â€” Large phone (â‰¤ 480px) â€” */
    @media (max-width: 480px) {
      .card { width: calc(100% - 2rem); }
      .invite-actions { grid-template-columns: 1fr; }
      .radio-row { flex-direction: column; }
    }

    /* â€” Small phone (â‰¤ 420px) â€” */
    @media (max-width: 420px) {
      .card {
        width: calc(100% - 1.5rem);
        padding: 0.85rem;
      }
      .card-inner {
        width: calc(100% - 1.2rem);
        padding: 1.6rem 0.9rem 1.8rem;
      }
      body.intro-view .card-inner { padding-top: 3rem; }
      .btn-submit { width: 100%; min-width: 0; }
    }

    /* â€” Very small phone (â‰¤ 380px) â€” */
    @media (max-width: 380px) {
      .couple-names { font-size: clamp(2.8rem, 10vw, 3.4rem); }
    }
  </style>
</head>
<body>

  <!-- Fallback for users with JavaScript disabled -->
  <noscript>
    <div style="position:fixed;inset:0;z-index:9999;background:#fdf6ec;display:flex;align-items:center;justify-content:center;text-align:center;font-family:'Georgia',serif;color:#0b1f3b;padding:2rem;">
      <div>
        <p style="font-size:1.4rem;font-weight:600;margin-bottom:0.75rem;">JavaScript is required to use this RSVP form.</p>
        <p style="font-size:1.1rem;">Please enable JavaScript in your browser and reload the page.</p>
      </div>
    </div>
  </noscript>

  <!-- â–’â–’â–’ CREAM RSVP CARD â–’â–’â–’ -->
  <div class="page">
    <div class="card">
      <div class="card-inner">

        <!-- Header -->
        <div class="header">
          <p class="reply-label">Kindly Reply By <span class="deadline-text"></span></p>
          <h1 class="couple-names">Varuni <span class="amp">&amp;</span> Varun</h1>
          <div class="divider"><span class="div-gem"></span></div>
          <p class="celebration-title">Wedding Celebrations</p>
          <p class="celebration-dates">
            25 &amp; 26 April 2026 | Kalaburagi
          </p>
        </div>

        <!-- â”€â”€ Page: Intro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="flow-page active" id="page-intro">
          <div class="invite-box">
            <h2 class="invite-title">Will you be joining us?</h2>
            <p class="invite-sub">Please choose an option to continue</p>
            <div class="invite-actions">
              <button type="button" class="plain-choice" id="choose-yes">Yes, I will join</button>
              <button type="button" class="plain-choice" id="choose-no">No, I can't join</button>
            </div>
            <p class="invite-bottom-reply">Kindly Reply By<br><span class="deadline-text"></span></p>
          </div>
        </div>

        <!-- â”€â”€ Page: No / Decline â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="flow-page" id="page-no">
          <button class="back-link" type="button">&#8592; Change response</button>
          <h2 class="page-no-title">We'll miss you :(</h2>
          <div class="decline-card">
            <form id="declineForm" class="decline-form">

              <div class="form-section form-section--sm">
                <label class="field-label" for="declineName">Your Name</label>
                <div class="input-wrap">
                  <input type="text" id="declineName" name="name" placeholder="Enter your full name" autocomplete="name">
                </div>
                <p class="error-msg" id="decline-name-error" role="alert"></p>
              </div>

              <div class="form-section form-section--sm">
                <label class="field-label" for="declineMsg">Would you like to leave a message? (optional)</label>
                <textarea id="declineMsg" name="message" placeholder="Your message"></textarea>
              </div>

              <div class="decline-submit-wrap">
                <button type="submit" class="ghost-btn" id="decline-submit">Submit</button>
              </div>
              <p class="error-msg" id="decline-submit-error" role="alert"></p>

            </form>

            <!-- Shown after decline submission; must live outside the form so it
                 isn't hidden when declineForm gets display:none -->
            <div id="decline-success" class="decline-success" role="alert" aria-live="assertive">
              <h2>Thank you!</h2>
              <p class="footer-line">We appreciate you letting us know.</p>
            </div>

          </div>
        </div>

        <!-- â”€â”€ Page: Yes / RSVP form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="flow-page" id="page-yes">
          <button class="back-link" type="button">&#8592; Change response</button>

          <div class="form-content" id="formContent">
            <form id="rsvpForm">

              <!-- 1. Name -->
              <div class="form-section">
                <label class="field-label" for="guestName">Your Name</label>
                <div class="input-wrap">
                  <input type="text" id="guestName" name="name" placeholder="Enter your full name" autocomplete="name" required>
                  <span class="input-suffix" aria-hidden="true">
                    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                    </svg>
                  </span>
                </div>
              </div>

              <!-- 2. Events -->
              <div class="form-section">
                <label class="field-label">Which Events Will You Be Attending?</label>
                <div class="events-list">

                  <div class="event-check">
                    <input type="checkbox" id="evt1" name="events" value="Reception â€” 25 April 2026 | Kalaburagi">
                    <label for="evt1">
                      <div class="ev-icon" aria-hidden="true">
                        <img src="assets/reception.png" alt="" width="30" height="30">
                      </div>
                      <div class="ev-info">
                        <span class="ev-name">Reception</span>
                        <span class="ev-date">25 April 2026 | Kalaburagi</span>
                      </div>
                      <div class="ev-indicator"></div>
                    </label>
                  </div>

                  <div class="event-check">
                    <input type="checkbox" id="evt2" name="events" value="Muhuratam â€” 26 April 2026 | Kalaburagi">
                    <label for="evt2">
                      <div class="ev-icon" aria-hidden="true">
                        <img src="assets/Muhuratam.png" alt="" width="30" height="30">
                      </div>
                      <div class="ev-info">
                        <span class="ev-name">Muhuratam</span>
                        <span class="ev-date">26 April 2026 | Kalaburagi</span>
                      </div>
                      <div class="ev-indicator"></div>
                    </label>
                  </div>

                </div>
                <p class="error-msg" id="events-error" role="alert"></p>
              </div>

              <!-- 3. Accommodation -->
              <div class="form-section" id="accommodation-section">
                <label class="field-label">Would You Require Accommodation?</label>
                <div class="radio-row">
                  <div class="radio-pill">
                    <input type="radio" name="accommodation" id="acc-yes" value="Yes">
                    <label for="acc-yes">Yes, Please</label>
                  </div>
                  <div class="radio-pill">
                    <input type="radio" name="accommodation" id="acc-no" value="No">
                    <label for="acc-no">No, Thank You</label>
                  </div>
                </div>
                <p class="error-msg" id="acc-error" role="alert"></p>
              </div>

              <!-- 4. Arrival & Departure (shown only when accommodation = Yes) -->
              <div class="form-section hidden" id="date-section">
                <label class="field-label">Arrival &amp; Departure</label>
                <div class="date-pair">
                  <div class="date-cell">
                    <span class="date-tiny">Arrival Date</span>
                    <input type="date" id="arrival" name="arrival" autocomplete="off">
                  </div>
                  <div class="date-cell-divider"></div>
                  <div class="date-cell">
                    <span class="date-tiny">Departure Date</span>
                    <input type="date" id="departure" name="departure" autocomplete="off">
                  </div>
                </div>
              </div>

              <!-- 5. Guest stepper -->
              <div class="form-section" id="guest-section">
                <label class="field-label">Number of Guests</label>
                <div class="stepper">
                  <button type="button" class="step-btn" id="dec-btn" aria-label="Decrease guest count">&#8722;</button>
                  <span class="guest-display" id="guest-display" aria-live="polite">1 Guest</span>
                  <button type="button" class="step-btn" id="inc-btn" aria-label="Increase guest count">&#43;</button>
                </div>
                <input type="hidden" name="guests" id="guest-val" value="1">
              </div>

              <!-- 6. Submit -->
              <div class="submit-wrap">
                <p class="error-msg" id="submit-error" role="alert"></p>
                <button type="submit" class="btn-submit" id="btn-submit">
                  <span>Send RSVP</span>
                  <svg class="btn-arrow" aria-hidden="true" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                  </svg>
                  <span class="btn-spinner"></span>
                </button>
                <p class="footer-line">We look forward to celebrating with you!</p>
              </div>

            </form>
          </div>
        </div>

        <!-- â”€â”€ Success state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="success" id="successMsg" role="alert" aria-live="assertive">
          <h2>Thank you<span id="success-name"></span>!</h2>
          <p class="footer-line">We look forward to celebrating with you!</p>
        </div>

      </div>
    </div>
  </div>

  <canvas id="confetti-canvas" aria-hidden="true"></canvas>

<script>
(function () {
  'use strict';

  /* â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * Set scriptUrl to your deployed Google Apps Script Web App URL.
   * See apps-script/Code.gs and DEPLOYMENT.md for instructions.
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  var CONFIG = {
    scriptUrl:   'https://script.google.com/macros/s/AKfycbzSYlr9cMnEpRaOuFPwke-hTiKPWz-qpPzJ1-4CPrMNWQxm2EOdD_kTHjzrx0v36brjrw/exec',
    rsvpDeadline: 'March 15, 2026',
    arrivalMin:  '2026-04-24',
    arrivalMax:  '2026-04-26'
  };

  /* â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  var pageIntro      = document.getElementById('page-intro');
  var pageNo         = document.getElementById('page-no');
  var pageYes        = document.getElementById('page-yes');
  var chooseYes      = document.getElementById('choose-yes');
  var chooseNo       = document.getElementById('choose-no');
  var declineForm    = document.getElementById('declineForm');
  var declineSuccess = document.getElementById('decline-success');
  var form           = document.getElementById('rsvpForm');
  var formContent    = document.getElementById('formContent');
  var successMsg     = document.getElementById('successMsg');
  var successName    = document.getElementById('success-name');
  var canvas         = document.getElementById('confetti-canvas');
  var guestDisplay   = document.getElementById('guest-display');
  var guestVal       = document.getElementById('guest-val');
  var decBtn         = document.getElementById('dec-btn');
  var incBtn         = document.getElementById('inc-btn');
  var dateSection    = document.getElementById('date-section');
  var arrivalInput   = document.getElementById('arrival');
  var departureInput = document.getElementById('departure');
  var deadlineEls    = document.querySelectorAll('.deadline-text');
  var happyAudioSrc  = 'assets/happy sound.mp3';
  var sadAudioSrc    = 'assets/sad sound.mp3';

  /* â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  /* Render the RSVP deadline from CONFIG into every .deadline-text span */
  deadlineEls.forEach(function (el) { el.textContent = CONFIG.rsvpDeadline; });

  /* Set date input bounds from CONFIG */
  arrivalInput.min   = CONFIG.arrivalMin;
  arrivalInput.max   = CONFIG.arrivalMax;
  departureInput.min = CONFIG.arrivalMin;
  departureInput.max = CONFIG.arrivalMax;

  document.body.classList.add('intro-view');

  /* â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  var guestCount       = 1;
  var noScaleStep      = 0;
  var noShrinkTimer    = null;
  var introChoiceLocked = false;
  var emojiRainTimer   = null;
  var emojiRainLayer   = null;
  var confettiActive   = false;
  var confettiRAF      = null;
  var confettiBits     = [];
  var confettiPal      = ['#c9a96e','#d4af37','#9a2038','#d86880','#dca0b0','#fdf6ec','#0d1b2a'];

  /* â”€â”€ Page navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function showPage(el) {
    [pageIntro, pageNo, pageYes].forEach(function (p) { p.classList.remove('active'); });
    el.classList.add('active');
    document.body.classList.remove('intro-view', 'no-view', 'yes-view');
    if (el === pageIntro) document.body.classList.add('intro-view');
    if (el === pageNo)    document.body.classList.add('no-view');
    if (el === pageYes)   document.body.classList.add('yes-view');

    /* Move focus to the first interactive element in the new page */
    var first = el.querySelector('button, input, textarea, a[href]');
    if (first) { window.setTimeout(function () { first.focus(); }, 50); }
  }

  /* Back buttons */
  document.querySelectorAll('.back-link').forEach(function (btn) {
    btn.addEventListener('click', function () { showPage(pageIntro); });
  });

  /* â”€â”€ Audio â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function playAudioAndWait(src, fallbackMs) {
    return new Promise(function (resolve) {
      var audio = new Audio(src);
      var done  = false;
      var finish = function () {
        if (done) return;
        done = true;
        audio.onended = null;
        audio.onerror = null;
        resolve();
      };
      var timer = window.setTimeout(finish, fallbackMs || 2400);
      audio.onended = function () { window.clearTimeout(timer); finish(); };
      audio.onerror = function () { window.clearTimeout(timer); finish(); };
      var p = audio.play();
      if (p && p.catch) { p.catch(function () { window.clearTimeout(timer); finish(); }); }
    });
  }

  /* â”€â”€ Guest stepper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function updateGuests(n) {
    guestCount = Math.max(1, Math.min(2, n));
    guestDisplay.textContent = guestCount === 1 ? '1 Guest' : guestCount + ' Guests';
    guestVal.value = guestCount;
  }
  decBtn.addEventListener('click', function () { updateGuests(guestCount - 1); });
  incBtn.addEventListener('click', function () { updateGuests(guestCount + 1); });

  /* â”€â”€ Emoji rain â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function ensureEmojiRainLayer() {
    if (emojiRainLayer) return emojiRainLayer;
    emojiRainLayer = document.createElement('div');
    emojiRainLayer.className = 'emoji-rain-layer';
    emojiRainLayer.setAttribute('aria-hidden', 'true');
    document.body.appendChild(emojiRainLayer);
    return emojiRainLayer;
  }

  function startThumbsDownShower() {
    var layer = ensureEmojiRainLayer();
    if (emojiRainTimer) return;
    emojiRainTimer = window.setInterval(function () {
      var drop = document.createElement('span');
      drop.className = 'emoji-drop';
      drop.textContent = '\uD83D\uDE22'; /* ðŸ˜¢ */
      drop.style.left = Math.round(Math.random() * 96) + '%';
      drop.style.fontSize = (1.1 + Math.random() * 1.2).toFixed(2) + 'rem';
      drop.style.animationDuration = (2.8 + Math.random() * 1.4).toFixed(2) + 's';
      layer.appendChild(drop);
      window.setTimeout(function () { drop.remove(); }, 5000);
    }, 180);
  }

  function stopThumbsDownShower() {
    if (emojiRainTimer) { window.clearInterval(emojiRainTimer); emojiRainTimer = null; }
    if (emojiRainLayer) {
      window.setTimeout(function () { if (emojiRainLayer) emojiRainLayer.innerHTML = ''; }, 500);
    }
  }

  /* â”€â”€ Confetti (unified) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function makeBit(fromTop) {
    return {
      x:    Math.random() * canvas.width,
      y:    fromTop
              ? -10 - Math.random() * 50
              : Math.random() * canvas.height * 0.35 - 30,
      w:    5 + Math.random() * 8,
      h:    4 + Math.random() * 5,
      c:    confettiPal[Math.floor(Math.random() * confettiPal.length)],
      vy:   2.2 + Math.random() * 3.3,
      vx:   (Math.random() - 0.5) * 1.8,
      a:    Math.random() * 360,
      spin: (Math.random() - 0.5) * 8
    };
  }

  /**
   * confetti({ continuous: true })  â€” keeps spawning until stopConfetti() is called
   * confetti({ burst: 120 })        â€” spawns N pieces immediately then stops
   */
  function confetti(opts) {
    var ctx = canvas.getContext('2d');
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;

    if (opts.continuous) {
      confettiActive = true;
    } else {
      var n = opts.burst || 120;
      for (var i = 0; i < n; i++) { confettiBits.push(makeBit(false)); }
    }

    if (confettiRAF) return; /* already animating */

    (function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (confettiActive) {
        for (var s = 0; s < 4; s++) { confettiBits.push(makeBit(true)); }
      }
      confettiBits = confettiBits.filter(function (b) {
        b.y += b.vy; b.x += b.vx; b.a += b.spin;
        if (b.y >= canvas.height + 20) return false;
        ctx.save();
        ctx.globalAlpha = Math.max(0, 1 - b.y / (canvas.height * 0.96));
        ctx.fillStyle   = b.c;
        ctx.translate(b.x, b.y);
        ctx.rotate(b.a * Math.PI / 180);
        ctx.fillRect(-b.w / 2, -b.h / 2, b.w, b.h);
        ctx.restore();
        return true;
      });
      if (confettiActive || confettiBits.length) {
        confettiRAF = requestAnimationFrame(draw);
      } else {
        confettiRAF = null;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    }());
  }

  function stopConfetti() { confettiActive = false; }

  /* â”€â”€ "No" button shrink â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function applyNoScale() {
    var scale = 1 - noScaleStep * 0.08;
    chooseNo.style.transform = 'scale(' + Math.max(0.52, scale) + ')';
  }

  function startNoShrink() {
    if (noShrinkTimer) return;
    noScaleStep = Math.min(noScaleStep + 1, 6);
    applyNoScale();
    noShrinkTimer = window.setInterval(function () {
      noScaleStep = Math.min(noScaleStep + 1, 6);
      applyNoScale();
      if (noScaleStep >= 6) { window.clearInterval(noShrinkTimer); noShrinkTimer = null; }
    }, 90);
  }

  function stopNoShrink() {
    if (!noShrinkTimer) return;
    window.clearInterval(noShrinkTimer);
    noShrinkTimer = null;
  }

  /* Mouse (desktop) + touch (mobile) */
  chooseNo.addEventListener('mouseenter',  startNoShrink);
  chooseNo.addEventListener('mouseleave',  stopNoShrink);
  chooseNo.addEventListener('touchstart',  startNoShrink, { passive: true });
  chooseNo.addEventListener('touchend',    stopNoShrink);
  chooseNo.addEventListener('focus', function () {
    noScaleStep = Math.min(noScaleStep + 1, 6);
    applyNoScale();
  });

  /* â”€â”€ Choice handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  chooseYes.addEventListener('click', function () {
    if (introChoiceLocked) return;
    introChoiceLocked = true;
    confetti({ continuous: true });
    playAudioAndWait(happyAudioSrc, 2600).then(function () {
      stopConfetti();
      showPage(pageYes);
      window.scrollTo({ top: 0, behavior: 'smooth' });
      introChoiceLocked = false;
    });
  });

  chooseNo.addEventListener('click', function () {
    if (introChoiceLocked) return;
    introChoiceLocked = true;
    startThumbsDownShower();
    playAudioAndWait(sadAudioSrc, 3200).then(function () {
      stopThumbsDownShower();
      showPage(pageNo);
      window.scrollTo({ top: 0, behavior: 'smooth' });
      introChoiceLocked = false;
    });
  });

  /* â”€â”€ Conditional dates (shown only when accommodation = Yes) â”€â”€ */
  document.querySelectorAll('input[name="accommodation"]').forEach(function (radio) {
    radio.addEventListener('change', function () {
      var needsAccom = document.getElementById('acc-yes').checked;
      if (needsAccom) {
        dateSection.classList.remove('hidden');
      } else {
        dateSection.classList.add('hidden');
        arrivalInput.value   = '';
        departureInput.value = '';
      }
    });
  });

  /* Enforce departure date >= arrival date */
  arrivalInput.addEventListener('change', function () {
    if (departureInput.value && departureInput.value < arrivalInput.value) {
      departureInput.value = arrivalInput.value;
    }
    departureInput.min = arrivalInput.value || CONFIG.arrivalMin;
  });

  /* â”€â”€ Inline error helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function showError(el, text) {
    el.textContent  = text;
    el.style.display = 'block';
    el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }

  function clearErrors(scope) {
    (scope || document).querySelectorAll('.error-msg').forEach(function (el) {
      el.style.display = 'none';
      el.textContent   = '';
    });
  }

  /* â”€â”€ Submission helper (no-cors POST to Apps Script) â”€â”€â”€â”€ */
  function postToSheet(payload) {
    /* URLSearchParams is a "simple" body, so no CORS preflight is needed.
     * With mode:'no-cors' the request reaches Apps Script; we cannot read
     * the response body, but the data is written to Google Sheets. */
    return fetch(CONFIG.scriptUrl, {
      method: 'POST',
      mode:   'no-cors',
      body:   new URLSearchParams(payload)
    });
  }

  /* â”€â”€ Decline form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  declineForm.addEventListener('submit', function (e) {
    e.preventDefault();
    clearErrors(declineForm);

    var nameVal = document.getElementById('declineName').value.trim();
    if (!nameVal) {
      showError(document.getElementById('decline-name-error'), 'Please enter your name.');
      return;
    }

    var submitBtn = document.getElementById('decline-submit');
    submitBtn.disabled    = true;
    submitBtn.textContent = 'Sending\u2026';

    postToSheet({
      attending: 'No',
      name:      nameVal,
      message:   document.getElementById('declineMsg').value.trim()
    }).then(function () {
      declineForm.classList.add('hide');
      declineSuccess.classList.add('show');
    }).catch(function () {
      submitBtn.disabled    = false;
      submitBtn.textContent = 'Submit';
      showError(document.getElementById('decline-submit-error'), 'Something went wrong â€” please try again.');
    });
  });

  /* â”€â”€ RSVP form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  form.addEventListener('submit', function (e) {
    e.preventDefault();
    clearErrors(form);

    /* Validate: at least one event selected */
    var evts = Array.from(form.querySelectorAll('.event-check input[type="checkbox"]:checked'))
                    .map(function (c) { return c.value; });
    if (!evts.length) {
      showError(document.getElementById('events-error'), 'Please select at least one event you will attend.');
      return;
    }

    /* Validate: name is required */
    var nameVal = document.getElementById('guestName').value.trim();
    if (!nameVal) {
      showError(document.getElementById('submit-error'), 'Please enter your name.');
      document.getElementById('guestName').focus();
      return;
    }

    /* Validate: accommodation answered */
    var accGroup = document.getElementById('accommodation-section');
    if (!Array.from(accGroup.querySelectorAll('input[type="radio"]')).some(function (r) { return r.checked; })) {
      showError(document.getElementById('acc-error'), 'Please indicate whether you need accommodation.');
      return;
    }

    /* Validate: dates required when accommodation = Yes */
    if (document.getElementById('acc-yes').checked) {
      if (!arrivalInput.value) {
        showError(document.getElementById('submit-error'), 'Please select your arrival date.');
        arrivalInput.focus();
        return;
      }
      if (!departureInput.value) {
        showError(document.getElementById('submit-error'), 'Please select your departure date.');
        departureInput.focus();
        return;
      }
      if (departureInput.value < arrivalInput.value) {
        showError(document.getElementById('submit-error'), 'Departure date must be on or after your arrival date.');
        departureInput.focus();
        return;
      }
    }
    var sub      = document.getElementById('btn-submit');
    sub.disabled = true;
    sub.classList.add('loading');
    sub.querySelector('span').textContent = 'Sending\u2026';

    postToSheet({
      attending:     "Yes, I'll be there",
      name:          nameVal,
      events:        evts.join(', '),
      accommodation: document.getElementById('acc-yes').checked ? 'Yes' : 'No',
      arrival:       arrivalInput.value,
      departure:     departureInput.value,
      guests:        guestVal.value
    }).then(function () {
      formContent.classList.add('hide');
      successMsg.classList.add('show');
      /* Show personalised name in the success heading */
      if (nameVal) {
        var firstName = nameVal.split(' ')[0];
        successName.textContent = ', ' + firstName;
      }
      confetti({ burst: 120 });
    }).catch(function () {
      sub.disabled = false;
      sub.classList.remove('loading');
      sub.querySelector('span').textContent = 'Send RSVP';
      showError(document.getElementById('submit-error'), 'Something went wrong â€” please try again.');
    });
  });

}());
</script>
</body>
</html>
